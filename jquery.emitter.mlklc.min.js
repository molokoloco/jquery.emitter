/*
    // Emitter sprites factory with jQuery & CSS3 V0.4
    // by molokoloco@gmail.com 17/10/2011
    // Infos : http://www.b2bweb.fr/molokoloco/emitter-sprites-particules-factory-with-jquery-css3/
	// Live demo V0.4 : http://jsfiddle.net/molokoloco/hDMKg/
	// Sources : https://github.com/molokoloco/jquery.emitter
*/

var db=function(){"console"in window&&console.log.call(console,arguments)}; (function(b,d){d.requestAnimFrame=function(){return d.requestAnimationFrame||d.webkitRequestAnimationFrame||d.mozRequestAnimationFrame||d.oRequestAnimationFrame||d.msRequestAnimationFrame||function(a){d.setTimeout(a,1E3/60)}}();b.getRand=function(a,b){return parseInt(a+Math.random()*(b-a),10)};b.getSize=function(a,b){a&&/\%/.test(a)&&(a=parseInt(a,10)/100*b);return parseInt(a,10)};b.getBrowser=function(){var a=navigator.userAgent.toLowerCase(),b={firefox:"Moz",applewebkit:"Webkit",webkit:"Webkit", opera:"O",msie:"ms",Konqueror:"Khtml"},c;for(c in b)if(a.indexOf(c)!==-1)return b[c];return false}();b.cssPrefixString={};b.cssPrefix=function(a){if(b.cssPrefixString[a]||b.cssPrefixString[a]==="")return b.cssPrefixString[a]+a;var d=document.createElement("div"),c=",Moz,Webkit,O,ms,Khtml".split(","),i;for(i in c)if(typeof d.style[c[i]+a]!=="undefined")return b.cssPrefixString[a]=c[i],c[i]+a;return false};b.fn.crossCss=function(a){return this.each(function(){var d=b(this);if(typeof a!="object")return d; if(a.transition)a[b.cssPrefix("Transition")]=a.transition;if(a.borderRadius||a.borderRadius===0)a[b.cssPrefix("borderRadius")]=a.borderRadius;if(a.borderImage)a[b.cssPrefix("borderImage")]=a.borderImage;if(a.maskImage)a[b.cssPrefix("maskImage")]=a.maskImage;if(a.transform)a[b.cssPrefix("Transform")]=a.transform;if(a.boxShadow)a[b.cssPrefix("boxShadow")]=a.boxShadow;return d.css(a)})};b.fn.emitter=function(a){for(var e in a)typeof a[e]=="object"&&b.fn.emitter.options[e]&&(a[e]=b.extend({},b.fn.emitter.options[e], a[e]));a=b.extend({},b.fn.emitter.options,a);return this.each(function(){var c=b(this),i,e,m,h,k,f,g,l,n,x,y,z,j,A,o,p,q,r,s,t,u,v;i=1E3;e=true;m=null;d.numSprites=0;var B=function(){h=parseInt(c.width());k=parseInt(c.height());a.transition&&(i=a.transition.split("ms")[0].split(" ")[1]);a.emitterCenterLeft=!a.emitterCenterLeft&&a.emitterCenterLeft!==0?h/2:b.getSize(a.emitterCenterLeft,h);a.emitterCenterTop=!a.emitterCenterTop&&a.emitterCenterTop!==0?k/2:b.getSize(a.emitterCenterTop,k);if(a.emitterRadius)a.emitterRadius= b.getSize(a.emitterRadius,h);if(a.cssFrom.width)a.cssFrom.width=b.getSize(a.cssFrom.width,h);if(a.cssFrom.height)a.cssFrom.height=b.getSize(a.cssFrom.height,k);if(a.cssFrom.maxSize)a.cssFrom.maxSize=b.getSize(a.cssFrom.maxSize,h);if(a.cssTo.width)a.cssTo.width=b.getSize(a.cssTo.width,h);if(a.cssTo.height)a.cssTo.height=b.getSize(a.cssTo.height,k);if(a.cssTo.maxSize)a.cssTo.maxSize=b.getSize(a.cssTo.maxSize,h)};B();var w=function(){if(d.numSprites<a.maxSprite){f=a.cssFrom.maxSize||a.cssFrom.maxSize=== 0?b.getRand(a.cssFrom.width,a.cssFrom.maxSize):a.cssFrom.width;g=a.cssFrom.height||a.cssFrom.height===0?a.cssFrom.maxSize||a.cssFrom.maxSize===0?b.getRand(a.cssFrom.height,a.cssFrom.maxSize):a.cssFrom.height:f;l=f/2;n=g/2;x=a.newAtTop=="random"?b.getRand(a.zIndex,a.zIndex+a.maxSprite):a.newAtTop?a.zIndex++:a.zIndex--;y=-l+b.getRand(-a.emitterRadius,a.emitterRadius);z=-n+b.getRand(-a.emitterRadius,a.emitterRadius);j=a.cssFrom.borderRadius||a.cssFrom.borderRadius===0?a.cssFrom.borderRadius:l+"px";A= b.extend({},a.cssFrom,{position:a.position,transition:a.transition,zIndex:x,left:a.emitterCenterLeft+"px",top:a.emitterCenterTop+"px",marginLeft:y+"px",marginTop:z+"px",width:f+"px",height:g+"px",borderRadius:j});switch(a.effect){case "nebula":if(a.cssTo.width||a.cssTo.width===0)f=a.cssTo.maxSize||a.cssTo.maxSize===0?b.getRand(a.cssTo.width,a.cssTo.maxSize):a.cssTo.width,l=f/2,j=l+"px",g=f,n=g/2;if(a.cssTo.height||a.cssTo.height===0)g=a.cssFrom.maxSize||a.cssFrom.maxSize===0?b.getRand(a.cssTo.height, a.cssTo.maxSize):a.cssFrom.height,n=g/2;j=a.cssTo.borderRadius||a.cssTo.borderRadius===0?a.cssTo.borderRadius:j;o=-a.emitterCenterLeft-f;p=-a.emitterCenterTop-g;q=h-a.emitterCenterLeft;r=k-a.emitterCenterTop;Math.random()>0.5?(s=b.getRand(o,q),t=Math.random()<0.5?p:r):(s=Math.random()<0.5?o:q,t=b.getRand(p,r));u=b.extend({},a.cssTo,{width:f+"px",height:g+"px",borderRadius:j,marginLeft:s+"px",marginTop:t+"px"});break;default:u=b.extend({},a.cssTo)}v=b(a.element).crossCss(A).appendTo(c);d.numSprites++; c.trigger("emit",[v]);setTimeout(function(a,b){a.crossCss(b);setTimeout(function(a){a.remove();d.numSprites--},i,a)},0,v,u)}f=void 0;g=void 0;l=void 0;n=void 0;x=void 0;y=void 0;z=void 0;j=void 0;A=void 0;o=void 0;p=void 0;q=void 0;r=void 0;s=void 0;t=void 0;u=void 0;v=void 0;a.rate?m=setTimeout(w,a.rate):e&&d.requestAnimFrame(w)};c.bind({start:function(){e=true;w()},stop:function(){e=false;m&&(clearTimeout(m),m=null)},create:function(){c.trigger("stop");w()},update:function(d,c){for(var e in c)typeof c[e]== "object"&&b.fn.emitter.options[e]&&(c[e]=b.extend({},a[e],c[e]));a=b.extend(a,c);B()}});c.trigger("start");return c})};b.fn.emitter.options={effect:"nebula",transition:"all 1000ms linear",newAtTop:"random",emitterRadius:0,emitterCenterLeft:null,emitterCenterTop:null,rate:null,maxSprite:30,element:"<div></div>",position:"absolute",zIndex:500,cssFrom:{width:"10%",maxSize:null},cssTo:{}}})(jQuery,window);