/*
    // Emitter sprites factory with jQuery & CSS3 V0.4
    // @author molokoloco@gmail.com 28/10/2011 - MIT License
    //
    // Infos : http://www.b2bweb.fr/molokoloco/emitter-sprites-particules-factory-with-jquery-css3/
    // Live Demo V0.4 : http://jsfiddle.net/molokoloco/hDMKg/
    // Live Demo V0.5 : http://jsfiddle.net/molokoloco/bGG6f/
    // Sources : https://github.com/molokoloco/jquery.emitter
*/

var db=function(){"console"in window&&console.log.call(console,arguments)};
(function(b,c){c.requestAnimFrame=function(){return c.requestAnimationFrame||c.webkitRequestAnimationFrame||c.mozRequestAnimationFrame||c.oRequestAnimationFrame||c.msRequestAnimationFrame||function(a){c.setTimeout(a,1E3/60)}}();b.getRand=function(a,b){return parseInt(a+Math.random()*(b-a),10)};b.getSize=function(a,b){a&&/\%/.test(a)&&(a=parseInt(a,10)/100*b);return parseInt(a,10)};b.getBrowser=function(){var a=navigator.userAgent.toLowerCase(),b={firefox:"Moz",applewebkit:"Webkit",webkit:"Webkit",
opera:"O",msie:"ms",Konqueror:"Khtml"},c;for(c in b)if(a.indexOf(c)!==-1)return b[c];return false}();b.cssPrefixString={};b.cssPrefix=function(a){if(b.cssPrefixString[a]||b.cssPrefixString[a]==="")return b.cssPrefixString[a]+a;var c=document.createElement("div"),e=",Moz,Webkit,O,ms,Khtml".split(","),d;for(d in e)if(typeof c.style[e[d]+a]!=="undefined")return b.cssPrefixString[a]=e[d],e[d]+a;return false};b.fn.crossCss=function(a){return this.each(function(){var c=b(this);if(typeof a!="object")return c;
if(a.transition)a[b.cssPrefix("Transition")]=a.transition;if(a.borderRadius||a.borderRadius===0)a[b.cssPrefix("borderRadius")]=a.borderRadius;if(a.borderImage)a[b.cssPrefix("borderImage")]=a.borderImage;if(a.maskImage)a[b.cssPrefix("maskImage")]=a.maskImage;if(a.transform)a[b.cssPrefix("Transform")]=a.transform;if(a.boxShadow)a[b.cssPrefix("boxShadow")]=a.boxShadow;return c.css(a)})};b.fn.emitter=function(a){for(var i in a)typeof a[i]=="object"&&b.fn.emitter.options[i]&&(a[i]=b.extend({},b.fn.emitter.options[i],
a[i]));a=b.extend({},b.fn.emitter.options,a);return this.each(function(){var e=b(this),d,i,n,x,j,k,f,g,h,m,o,y,z,A,l,B,p,q,r,s,u,v,C;d="emitter"+Date.now();i=true;n=null;x=b.getBrowser.toLowerCase()+"TransitionEnd";c[d]=[];var D=function(){j=parseInt(e.width(),10);k=parseInt(e.height(),10);a.emitterCenterLeft=!a.emitterCenterLeft&&a.emitterCenterLeft!==0?j/2:b.getSize(a.emitterCenterLeft,j);a.emitterCenterTop=!a.emitterCenterTop&&a.emitterCenterTop!==0?k/2:b.getSize(a.emitterCenterTop,k);if(a.emitterRadius)a.emitterRadius=
b.getSize(a.emitterRadius,j);if(a.cssFrom.width)a.cssFrom.width=b.getSize(a.cssFrom.width,j);if(a.cssFrom.height)a.cssFrom.height=b.getSize(a.cssFrom.height,k);if(a.cssFrom.maxSize)a.cssFrom.maxSize=b.getSize(a.cssFrom.maxSize,j);if(a.cssTo.width)a.cssTo.width=b.getSize(a.cssTo.width,j);if(a.cssTo.height)a.cssTo.height=b.getSize(a.cssTo.height,k);if(a.cssTo.maxSize)a.cssTo.maxSize=b.getSize(a.cssTo.maxSize,j)};D();var E=function(a,d,e){c[a][d].crossCss(e);c[a][d].bind(x+" transitionend",function(){c[a][d].unbind(x+
" transitionend");c[a][d].attr("style","");b.data(c[a][d],"used",0)})},w=function(){f=-1;for(var t=0;t<a.maxSprite;t++)if(!c[d][t]||!b.data(c[d][t],"used")){f=t;break}if(f>=0){g=a.cssFrom.maxSize||a.cssFrom.maxSize===0?b.getRand(a.cssFrom.width,a.cssFrom.maxSize):a.cssFrom.width;h=a.cssFrom.height||a.cssFrom.height===0?a.cssFrom.maxSize||a.cssFrom.maxSize===0?b.getRand(a.cssFrom.height,a.cssFrom.maxSize):a.cssFrom.height:g;m=g/2;o=h/2;y=a.newAtTop=="random"?b.getRand(a.zIndex,a.zIndex+a.maxSprite):
a.newAtTop?null:a.zIndex--;z=-m+b.getRand(-a.emitterRadius,a.emitterRadius);A=-o+b.getRand(-a.emitterRadius,a.emitterRadius);l=a.cssFrom.borderRadius||a.cssFrom.borderRadius===0?a.cssFrom.borderRadius:m+"px";B=b.extend({},a.cssFrom,{position:a.position,zIndex:y,left:a.emitterCenterLeft+"px",top:a.emitterCenterTop+"px",marginLeft:z+"px",marginTop:A+"px",width:g+"px",height:h+"px",borderRadius:l});if(a.cssTo.width||a.cssTo.width===0)g=a.cssTo.maxSize||a.cssTo.maxSize===0?b.getRand(a.cssTo.width,a.cssTo.maxSize):
a.cssTo.width,m=g/2,l=m+"px",h=g,o=h/2;if(a.cssTo.height||a.cssTo.height===0)h=a.cssTo.maxSize||a.cssTo.maxSize===0?b.getRand(a.cssTo.height,a.cssTo.maxSize):a.cssTo.height,o=h/2;l=a.cssTo.borderRadius||a.cssTo.borderRadius===0?a.cssTo.borderRadius:l;switch(a.effect){case "artifice":p=-a.emitterCenterLeft;q=-a.emitterCenterTop;r=j-a.emitterCenterLeft-g;s=k-a.emitterCenterTop-h;break;default:p=-a.emitterCenterLeft-g,q=-a.emitterCenterTop-h,r=j-a.emitterCenterLeft,s=k-a.emitterCenterTop}if(a.effect==
"artifice"||a.effect=="nebula")Math.random()>0.5?(u=b.getRand(p,r),v=Math.random()<0.5?q:s):(u=Math.random()<0.5?p:r,v=b.getRand(q,s));C=b.extend({},a.cssTo,{transition:a.transition,width:g+"px",height:h+"px",borderRadius:l,marginLeft:u+"px",marginTop:v+"px"});if(!c[d][f]||c[d][f].length<1)c[d][f]=b(a.element).appendTo(e);b.data(c[d][f],"used",1);c[d][f].crossCss(B);e.trigger("emit",[c[d][f]]);setTimeout(E,0,d,f,C)}f=void 0;g=void 0;h=void 0;m=void 0;o=void 0;y=void 0;z=void 0;A=void 0;l=void 0;B=
void 0;p=void 0;q=void 0;r=void 0;s=void 0;u=void 0;v=void 0;C=void 0;a.rate?n=setTimeout(w,a.rate):i&&c.requestAnimFrame(w)};e.bind({start:function(){i=true;w()},stop:function(){i=false;n&&(clearTimeout(n),n=null)},create:function(){e.trigger("stop");w()},update:function(c,d){for(var e in d)typeof d[e]=="object"&&b.fn.emitter.options[e]&&(d[e]=b.extend({},a[e],d[e]));a=b.extend(a,d);D()}});e.trigger("start");return e})};b.fn.emitter.options={effect:"nebula",transition:"all 1000ms linear",newAtTop:"random",
emitterRadius:0,emitterCenterLeft:null,emitterCenterTop:null,rate:null,maxSprite:30,element:"<div></div>",position:"absolute",zIndex:500,cssFrom:{width:"10%",maxSize:null},cssTo:{}}})(jQuery,window);